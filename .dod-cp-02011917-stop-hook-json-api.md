# DoD - Stop Hook 和 SubagentStop Hook JSON API 改造

QA: docs/QA-DECISION.md

## 验收标准

### 功能验收
- [ ] Stop Hook 使用 JSON API 格式（{"decision": "block", "reason": "..."}）
      Test: tests/hooks/stop-hook.test.ts
- [ ] Stop Hook 重试上限为 15 次
      Test: tests/hooks/stop-hook-retry.test.ts
- [ ] Stop Hook 超限后调用 track.sh 上报失败
      Test: tests/hooks/stop-hook-retry.test.ts
- [ ] SubagentStop Hook 已创建并支持 Explore/Plan agent 类型
      Test: tests/hooks/subagent-stop.test.ts (待创建)
- [ ] SubagentStop Hook 重试上限为 5 次
      Test: tests/hooks/subagent-stop.test.ts (待创建)
- [ ] SubagentStop Hook 超限后正确退出
      Test: tests/hooks/subagent-stop.test.ts (待创建)
- [ ] 所有 exit 2 改为 jq -n 输出 JSON + exit 0
      Test: tests/hooks/stop-hook-exit.test.ts
- [ ] .claude/settings.json 已更新 SubagentStop Hook 配置
      Test: manual:检查 .claude/settings.json 包含 SubagentStop Hook 配置
- [ ] 强制循环机制生效：AI 不会"停下来等用户输入"
      Test: manual:实际运行 /dev 流程验证自动继续执行

### 测试验收
- [ ] npm run qa 通过
      Test: contract:H7-001,H7-002,H7-003
