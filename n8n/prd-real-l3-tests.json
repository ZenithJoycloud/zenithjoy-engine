{
  "id": "real-l3-tests",
  "title": "完整实现 L3 回归测试自动化",
  "checkpoints": [
    {
      "id": "CP-001",
      "title": "分析 RCI 结构",
      "status": "pending",
      "prompt": "分析 /home/xx/dev/zenithjoy-engine/regression-contract.yaml 的结构。\n\n任务：\n1. 统计所有 method: auto 的 RCI 数量\n2. 统计 evidence.type 分布 (command vs file)\n3. 列出所有 trigger: [PR] 和 trigger: [Release] 的 RCI ID\n4. 确定解析方案：检查系统是否有 yq，没有就用 grep/awk\n\n输出：在项目根目录创建 .l3-analysis.md 文件，包含以上分析结果。"
    },
    {
      "id": "CP-002",
      "title": "创建 RCI 解析函数",
      "status": "pending",
      "prompt": "基于 CP-001 的分析结果，重写 /home/xx/dev/zenithjoy-engine/scripts/run-regression.sh。\n\n任务：\n1. 创建 parse_rcis() 函数，解析 regression-contract.yaml\n2. 提取每个 RCI 的：id, trigger, method, evidence.type, evidence.run, evidence.contains\n3. 输出格式：每行一个 RCI，字段用 | 分隔\n\n验证：运行脚本能输出 RCI 列表。\n\n注意：保留原有的 L1、L2 测试逻辑，只重写 L3 部分。"
    },
    {
      "id": "CP-003",
      "title": "实现 trigger 过滤",
      "status": "pending",
      "prompt": "继续完善 /home/xx/dev/zenithjoy-engine/scripts/run-regression.sh。\n\n任务：\n1. 创建 filter_by_trigger() 函数\n2. pr 模式：只返回 trigger 包含 PR 的 RCI\n3. release 模式：只返回 trigger 包含 Release 的 RCI\n4. nightly 模式：返回所有 method: auto 的 RCI\n\n验证：\n- bash scripts/run-regression.sh pr --dry-run 显示 PR 触发的 RCI\n- bash scripts/run-regression.sh release --dry-run 显示 Release 触发的 RCI"
    },
    {
      "id": "CP-004",
      "title": "实现 evidence 执行",
      "status": "pending",
      "prompt": "继续完善 /home/xx/dev/zenithjoy-engine/scripts/run-regression.sh。\n\n任务：\n1. 创建 run_evidence() 函数\n2. type=command：执行 evidence.run 命令，检查输出匹配 evidence.contains 正则\n3. type=file：检查 evidence.path 文件是否存在\n4. 记录 passed/failed/skipped 计数\n5. 失败时显示具体错误信息\n\n验证：bash scripts/run-regression.sh pr 能执行并显示测试结果。"
    },
    {
      "id": "CP-005",
      "title": "集成测试",
      "status": "pending",
      "prompt": "测试 /home/xx/dev/zenithjoy-engine/scripts/run-regression.sh 三种模式。\n\n任务：\n1. 运行 bash scripts/run-regression.sh pr，确认通过\n2. 运行 bash scripts/run-regression.sh release，确认通过\n3. 运行 bash scripts/run-regression.sh nightly，确认通过\n4. 如果有失败，修复问题\n\n输出：三种模式都通过的截图或日志。"
    },
    {
      "id": "CP-006",
      "title": "提交 PR",
      "status": "pending",
      "prompt": "在 /home/xx/dev/zenithjoy-engine 项目中提交 PR。\n\n任务：\n1. 确保当前在 cp-0122-real-l3-tests 分支\n2. npm version patch 更新版本号\n3. 更新 CHANGELOG.md\n4. 更新 .dod.md\n5. git add && git commit\n6. git push origin cp-0122-real-l3-tests\n7. gh pr create --base develop\n\n输出：PR URL。"
    }
  ]
}
