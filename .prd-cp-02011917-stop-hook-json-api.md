## PRD - Stop Hook 和 SubagentStop Hook JSON API 改造

**Branch**: cp-02011917-stop-hook-json-api

**需求来源**: 用户要求改造 Stop Hook 和 SubagentStop Hook 到 JSON API，实现强制循环机制

**功能描述**:
当前 Stop Hook 使用 `exit 2` 阻止会话结束，但不能强制 AI 继续执行，导致经常"停下来等用户输入"。需要改用官方 JSON API（`{"decision": "block", "reason": "..."}`），通过强制喂入 `reason` 作为 prompt 来实现真正的循环。

同时新增 SubagentStop Hook，让子 agent（Explore、Plan 等）也能循环执行直到完成。

**涉及文件**:
- `hooks/stop.sh` - 主 Agent Stop Hook（修改）
- `hooks/subagent-stop.sh` - 子 Agent SubagentStop Hook（新建）
- `.claude/settings.json` - Hook 配置（更新）
- `tests/hooks/stop-hook-json.test.ts` - 测试用例（新建）

**成功标准**:
1. Stop Hook 改用 JSON API，所有 `exit 2` 改为 `jq -n ... + exit 0`
2. 重试上限：主 Agent 15 次，Subagent 5 次
3. 超限后上报失败到 track.sh
4. SubagentStop Hook 支持 Explore/Plan 等多种 agent 类型
5. 测试验证：强制循环生效，不会"停下来等输入"

**非目标**:
- 不改变循环检查的核心逻辑（PR 创建、CI 状态、PR 合并）
- 不移除 exit 2 的 fallback 机制
- 不改变 .dev-mode 文件格式
