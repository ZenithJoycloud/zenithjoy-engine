---
id: prd-fix-test-pollution
version: 1.0.0
created: 2026-01-23
updated: 2026-01-23
changelog:
  - 1.0.0: 初始版本
---

# PRD - 修复测试目录污染

Priority: P0

## 背景

tests/hooks/pr-gate-phase2.test.ts 直接在 PROJECT_ROOT/.history/ 创建测试文件，导致：
1. Hook 环境测试不稳定（随机失败 16/186）
2. 测试失败时残留文件污染项目目录
3. 并发测试可能竞争同一目录

这导致必须用 `gh api` 绕过 Hook，破坏质量门禁。

## 目标

修改测试使用独立临时目录，不污染 PROJECT_ROOT。

## 验收标准

- 所有测试使用 TEST_DIR 而非 PROJECT_ROOT
- afterAll 清理残留文件
- Hook 环境测试稳定通过
