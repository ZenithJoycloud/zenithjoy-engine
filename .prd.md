---
id: dev-ralph-loop-auto
version: 1.0.0
created: 2026-01-27
updated: 2026-01-27
changelog:
  - 1.0.0: 初始版本
---

## PRD - /dev 自动启用 Ralph Loop + 解决循环死锁问题

**需求来源**: 用户完整 PRD - /dev 自动启用 Ralph Loop + 解决循环死锁问题

**功能描述**:

### 背景问题
1. Ralph Loop 没有自动启用 - 需要手动启动
2. SHA 不匹配死循环 - 每次提交 evidence 后 SHA 变了，CI 又失败
3. 版本号总忘记更新 - 每次 PR 都因为 version-check 失败
4. 其他常见问题 - DoD 格式、registry 未更新、派生视图未生成

### 期望行为
- **p0 阶段**: /dev 在 Step 7 自动启动 Ralph Loop，循环处理所有质检问题直到 PR 创建
- **p1 阶段**: CI fail 时自动启动 Ralph Loop 修复直到通过

### 核心改动
1. /dev 自动启用 Ralph Loop（skills/dev/SKILL.md）
2. 解决 SHA 死循环：一次性提交所有改动（skills/dev/steps/07-quality.md）
3. 版本号自动更新（scripts/auto-update-version.sh）
4. CI SHA 检查逻辑调整（.github/workflows/ci.yml）

**涉及文件**:
- skills/dev/SKILL.md（新增 Ralph Loop 自动启动逻辑）
- skills/dev/steps/07-quality.md（一次性提交流程）
- skills/dev/steps/09-ci.md（p1 自动启动 Ralph Loop）
- scripts/auto-update-version.sh（新建）
- scripts/auto-update-registry.sh（新建）
- scripts/auto-fix-dod.sh（新建）
- scripts/update-changelog.sh（新建）
- .github/workflows/ci.yml（SHA 检查逻辑）
- docs/QA-DECISION.md（QA 决策文档）

**成功标准**:
- [ ] /dev 在 Step 7 自动启动 Ralph Loop
- [ ] Ralph Loop max-iterations=20
- [ ] p1 阶段自动启动 Ralph Loop
- [ ] SHA 不匹配问题解决（一次性提交）
- [ ] 版本号自动更新（feat/fix/feat!）
- [ ] CHANGELOG 自动更新
- [ ] hook-core/VERSION 自动更新
- [ ] Registry 自动更新（改核心文件时）
- [ ] 派生视图自动生成
- [ ] DoD 格式自动修复
- [ ] CI SHA 检查支持单 commit
- [ ] 端到端测试：/dev → Loop → PR → CI pass → merge
