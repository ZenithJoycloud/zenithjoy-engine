---
id: prd-fix-medium-p1-issues
version: 1.0.0
created: 2026-01-23
updated: 2026-01-23
changelog:
  - 1.0.0: 初始版本
---

# PRD - 修复 MEDIUM P1 级问题

## 需求来源

深度审计发现的 MEDIUM 严重性问题中，筛选出 P1 优先级（功能性问题，可能导致脚本行为错误）。

## 功能描述

### 1. Hooks 修复
- branch-protect.sh: cd 失败时 exit 0 改为 exit 2（防止绕过保护）
- session-start.sh: 输出改为 stderr（防止 Hook 框架误解析）

### 2. Scripts 修复
- deploy.sh: glob 无匹配时跳过循环（防止部署失败）
- run-regression.sh: trap 添加 INT TERM 信号（防止临时文件残留）
- metrics.cjs: 参数解析添加越界检查
- append-learnings.cjs: 参数解析添加越界检查

## 成功标准

- cd 失败时脚本安全退出（非 exit 0）
- Hook 输出到 stderr
- glob 空值时不报错
- Ctrl+C 时临时文件被清理
- 参数缺失时给出清晰错误而非崩溃
