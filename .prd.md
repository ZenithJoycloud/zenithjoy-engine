## PRD - Stop Hook TTY 会话隔离 (H7 fix)

**需求来源**: 用户反馈多 terminal 窗口同时使用 Claude Code 时，stop hook 输出会干扰非 /dev 会话，造成"串线"体验。

**功能描述**: 在有头模式下，使用 TTY (`/dev/pts/N`) 作为会话标识写入 `.dev-mode` 文件。Stop hook 检查时比较当前 TTY 与文件中的 TTY，不匹配则 exit 0（允许结束），避免干扰其他 terminal。无头模式继续使用 `CLAUDE_SESSION_ID`。

**涉及文件**:
- `hooks/stop.sh` — 添加 TTY 检查逻辑（134-142 行附近）
- `skills/dev/steps/03-branch.md` — .dev-mode 创建模板添加 `tty:` 字段

**成功标准**:
1. `.dev-mode` 文件包含 `tty: /dev/pts/N` 字段（有头模式）
2. Stop hook 读取 `tty:` 字段，当前 TTY 不匹配时 exit 0
3. 当前 TTY 匹配时正常执行完成条件检查（exit 2）
4. 无头模式（`CECELIA_HEADLESS=true`）行为不变
5. `CLAUDE_SESSION_ID` 逻辑保持不变作为 fallback

**向后兼容**: 现有 `.dev-mode` 文件如果没有 `tty:` 字段，TTY 检查直接跳过（不匹配视为"无法判断"，继续后续 session_id 检查）。不会破坏已有流程。

**非目标**:
- 不修改 branch-protect.sh
- 不修改无头模式的任何逻辑
- 不重构 stop.sh 的其他部分
